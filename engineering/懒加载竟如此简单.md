> IntersectionObserver接口(从属于Intersection Observer API)为开发者提供了一种可以异步监听目标元素与其祖先或视窗(viewport)交叉状态的手段。祖先元素与视窗(viewport)被称为根(root)。

好官方的描述！！！

不用管它，简单点说，`IntersectionObserver`就是观察一个元素是否在当前窗口中。

### 使用方法
```javascript
/**
 * @param {Function} callback 必填项，监听元素进入窗口时的回调函数
 * @param {Object} options 非必填项，配置参数
 * @param {Dom Element} options.root 监听元素的根元素，默认为全文档
 * @param {String} options.rootMargin 元素到根元素边缘时的矩形偏移量，支持 px 和 %
 * @param {Array} options.thresholds 交叉区域与边界区域的比例
*/

var io = new IntersectionObserver(callback, options);

io.observe(document.querySelector('img')); // 开始观察，接受一个DOM节点对象
io.unobserve(element); // 停止观察 接受一个element元素
io.disconnect(); // 关闭观察器
```

懵了么？还好，API的方法和属性比较少，先来撸一个案例你就明白怎么用了。

### 案例
```html
<div id='app'>
  <img src='./images/01.png'>
  <img src='./images/01.png' >
  <img src='./images/01.png' >
  <img src='./images/01.png' >
  <img src='./images/01.png' >
  <img src='./images/01.png' >
</div>

<script>
  // 创建IntersectionObserver实例
  const io = new IntersectionObserver(function (entrys) {
    console.log(entrys);
  }, {threshold: [1]});

  function update () {
    const els = document.querySelectorAll('img');
    els.forEach(ele => {
      io.observe(ele); // 对元素进行监听
    });
  }

  update();
</script>
```

此时，控制台会打印出监听的列表，注意列表中的每个元素都是一个监听器，其中`target`属性就是监听的元素，`isIntersecting`就是该元素是否在窗口内的标识。

### 图片懒加载
首先我们常见的懒加载插件有什么内容呢？

- 默认占位图
- `img`元素上具有真实地址属性，如`data-src`
- 我们刚刚看到的`options.thresholds`，即交叉区域与边界区域的比例

```javascript
class InterObser {
  constructor (attr = 'data-src', defaultImg, options = {}) {
    this.attr = attr;
    this.defaultImg = defaultImg;
    this.options = options;
    
    this.install();
    this.update();
  }
  install () {
    const that = this;
    // 初始化 IntersectionObserver 实例
    that.io = new IntersectionObserver(function (entrys) {
      // 当监听到元素进入窗口时，循环每个监听器
      entrys.forEach(ele => {
        // 如果该监听器进入窗口，则将真实地址替换占位图
        if (ele.isIntersecting) {
          that.imgLoad(ele);
          // 停止对该监听器的监听，防止多次操作
          that.io.unobserve(ele.target);
        }
      });
    }, that.options);
  }
  // 图片加载
  imgLoad (ele) {
    const url = ele.target.getAttribute(this.attr);
    ele.target.setAttribute('src', url);
  }
  update () {
    const els = document.querySelectorAll(`[${this.attr}]`);
    // 为每个监听元素设置默认值
    els.forEach(ele => {
      ele.setAttribute('src', this.defaultImg);
      // 开始监听
      this.io.observe(ele);
    });
  }
}

// 调用
new InterObser('data-src', './images/01.png', {threshold: [1]});
```